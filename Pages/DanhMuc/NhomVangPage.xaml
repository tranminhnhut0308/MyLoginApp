<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:MyLoginApp.ViewModels"
             x:Class="MyLoginApp.Pages.NhomVangPage"
             Title="Quáº£n lÃ½ NhÃ³m VÃ ng">

    <ContentPage.BindingContext>
        <viewmodels:NhomVangViewModel />
    </ContentPage.BindingContext>

    <!-- Tá»•ng Layout chia theo Grid -->
    <Grid RowDefinitions="Auto,*,Auto" Padding="10">

        <!-- KHU Vá»°C NÃšT ÄIá»€U KHIá»‚N -->
        <HorizontalStackLayout Grid.Row="0" Spacing="15" HorizontalOptions="CenterAndExpand" Margin="0,0,0,10">

            <Button Text="âž• ThÃªm" Command="{Binding ShowAddFormCommand}"
                    BackgroundColor="#4CAF50" TextColor="Black" WidthRequest="110" HeightRequest="50" CornerRadius="20" />

            <Button Text="âœï¸ Sá»­a"
                    Command="{Binding ShowEditFormCommand}"
                    IsEnabled="{Binding SelectedNhomVang, Converter={StaticResource NullToBoolConverter}}"
                    BackgroundColor="#FFCF07"
                    TextColor="Black"
                    WidthRequest="110"
                    HeightRequest="50"
                    CornerRadius="20">
                <Button.Triggers>
                    <Trigger TargetType="Button" Property="IsEnabled" Value="False">
                        <Setter Property="BackgroundColor" Value="#FFCF07" />
                        <Setter Property="Opacity" Value="0.7" />
                    </Trigger>
                </Button.Triggers>
            </Button>

            <Button Text="ðŸ—‘ï¸ XÃ³a"
                    Command="{Binding DeleteCommand}" 
                    IsEnabled="{Binding SelectedNhomVang, Converter={StaticResource SelectedItemToBoolConverter}}"
                    BackgroundColor="#F44336"
                    TextColor="Black"
                    WidthRequest="110"
                    HeightRequest="50"
                    CornerRadius="20">
                <Button.Triggers>
                    <Trigger TargetType="Button" Property="IsEnabled" Value="False">
                        <Setter Property="BackgroundColor" Value="#F44336" />
                        <Setter Property="Opacity" Value="0.7" />
                    </Trigger>
                </Button.Triggers>
            </Button>
        </HorizontalStackLayout>

        <!-- KHU Vá»°C FORM + DANH SÃCH -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="15">

                <!-- FORM THÃŠM -->
                <Frame BorderColor="Green" CornerRadius="15" Padding="10" IsVisible="{Binding IsAdding}">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="âž• ThÃªm nhÃ³m vÃ ng má»›i" FontAttributes="Bold" FontSize="20" TextColor="Green" HorizontalOptions="Center" />
                        <Entry Placeholder="TÃªn nhÃ³m vÃ ng" Text="{Binding FormNhomVang.TenNhom}" />
                        <Entry Placeholder="KÃ½ hiá»‡u" Text="{Binding FormNhomVang.KyHieu}" />
                        <HorizontalStackLayout HorizontalOptions="Center" Spacing="15">
                            <Button Text="ðŸ’¾ LÆ°u" Command="{Binding SaveAddCommand}" BackgroundColor="Green" TextColor="White" WidthRequest="100" />
                            <Button Text="âŒ Há»§y" Command="{Binding CancelAddEditCommand}" BackgroundColor="Gray" TextColor="White" WidthRequest="100" />
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Frame>

                <!-- FORM Sá»¬A -->
               
                <Frame BorderColor="Orange" CornerRadius="15" Padding="10" IsVisible="{Binding IsEditing}">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="âœï¸ Cáº­p nháº­t nhÃ³m vÃ ng" FontAttributes="Bold" FontSize="{OnPlatform Android=18, iOS=18, Default=20}" TextColor="Orange" HorizontalOptions="Center" />

                        <Label Text="TÃªn nhÃ³m vÃ ng:" FontAttributes="Bold" TextColor="#333333" Margin="0,5,0,0"/>
                        <Entry Placeholder="Nháº­p tÃªn nhÃ³m vÃ ng" Text="{Binding FormNhomVang.TenNhom}" />

                        <Label Text="KÃ½ hiá»‡u:" FontAttributes="Bold" TextColor="#333333" Margin="0,5,0,0"/>
                        <Entry Placeholder="Nháº­p kÃ½ hiá»‡u" Text="{Binding FormNhomVang.KyHieu}" />

                        <Label Text="Sá»­ dá»¥ng:" FontAttributes="Bold" TextColor="#333333" Margin="0,5,0,0"/>
                        <Switch IsToggled="{Binding FormNhomVang.SuDung, Converter={StaticResource IntToBoolConverter}}" 
OnColor="Green" ThumbColor="White" HorizontalOptions="Start" />

                        <HorizontalStackLayout HorizontalOptions="Center" Spacing="15" Margin="0,10,0,0">
                            <Button Text="ðŸ’¾ LÆ°u" Command="{Binding SaveEditCommand}" BackgroundColor="Green" TextColor="White" WidthRequest="100" />
                            <Button Text="âŒ Há»§y" Command="{Binding CancelAddEditCommand}" BackgroundColor="Gray" TextColor="White" WidthRequest="100" />
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Frame>

                <!-- DANH SÃCH NHÃ“M VÃ€NG -->
                <Frame BackgroundColor="#FF9800" 
                        BorderColor="#FF9800" 
                        CornerRadius="10" 
                        Padding="15" 
                        Margin="0,0,0,10"
                        HasShadow="True">
                    <Label Text="ðŸ“‹ Danh sÃ¡ch nhÃ³m vÃ ng" 
                            FontAttributes="Bold" 
                            FontSize="{OnPlatform Android=20, iOS=20, Default=22}" 
                            HorizontalOptions="Center" 
                            TextColor="#333333" />
                </Frame>

                <CollectionView 
                        ItemsSource="{Binding ListNhomVang}"
                        SelectionMode="None"
                        IsVisible="{Binding IsShowingList}" 
                        Margin="0,0,0,10">

                    <CollectionView.ItemsLayout>
                        <GridItemsLayout Orientation="Vertical" Span="2" HorizontalItemSpacing="10" VerticalItemSpacing="10" />
                    </CollectionView.ItemsLayout>

                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame CornerRadius="10" Padding="10" HasShadow="True" BackgroundColor="#E8E8E8" BorderColor="#DDD" Margin="3">
                                <Frame.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:NhomVangViewModel}}, Path=SelectItemCommand}" 
                                                          CommandParameter="{Binding .}" />
                                </Frame.GestureRecognizers>
                                <Frame.Style>
                                    <Style TargetType="Frame">
                                        <Setter Property="BackgroundColor" Value="#E8E8E8" />
                                        <Setter Property="BorderColor" Value="#DDD" />
                                        <Setter Property="HasShadow" Value="True" />
                                        <Style.Triggers>
                                            <DataTrigger TargetType="Frame"
                                                Binding="{Binding IsSelected}" 
                                                Value="True">
                                                <Setter Property="BackgroundColor" Value="#E8E8E8"/>
                                                <Setter Property="BorderColor" Value="#FF9800"/>
                                                <Setter Property="HasShadow" Value="True" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Frame.Style>

                                <!-- ThÃ´ng tin nhÃ³m vÃ ng -->
                                <VerticalStackLayout Spacing="5">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <Label Grid.Column="0" Text="{Binding TenNhom}" FontAttributes="Bold" FontSize="16" LineBreakMode="TailTruncation" TextColor="Black" />
                                        <!-- Biá»ƒu tÆ°á»£ng Ä‘Ã¡nh dáº¥u Ä‘ang sá»­ dá»¥ng -->
                                        <Label Grid.Column="1" 
                                               Text="âœ“" 
                                               TextColor="Green" 
                                               FontSize="16" 
                                               IsVisible="{Binding SuDung, Converter={StaticResource IntToBoolConverter}}" />
                                    </Grid>
                                    <Label Text="{Binding KyHieu}" FontSize="13" TextColor="Black" />
                                </VerticalStackLayout>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </ScrollView>

        <!-- KHU Vá»°C PHÃ‚N TRANG - Äáº¶T á»ž DÆ¯á»šI CÃ™NG -->
        <Frame Grid.Row="2" 
               BackgroundColor="White" 
               BorderColor="#FF9800" 
               CornerRadius="10" 
               Padding="10" 
               Margin="0,10,0,0"
               HasShadow="True">
            <HorizontalStackLayout HorizontalOptions="Center" Spacing="15">
                <Button Text="â®ï¸" 
                        Command="{Binding PreviousPageCommand}"
                        IsEnabled="{Binding CanGoPrevious}"
                        BackgroundColor="#FF9800"
                        TextColor="White"
                        WidthRequest="50"
                        HeightRequest="40"
                        CornerRadius="20"/>

                <Label Text="{Binding CurrentPage, StringFormat='Trang {0}'}"
                       VerticalOptions="Center"
                       FontSize="16"/>

                <Label Text="{Binding TotalPages, StringFormat='/ {0}'}"
                       VerticalOptions="Center"
                       FontSize="16"/>

                <Button Text="â­ï¸"
                        Command="{Binding NextPageCommand}"
                        IsEnabled="{Binding CanGoNext}"
                        BackgroundColor="#FF9800"
                        TextColor="White"
                        WidthRequest="50"
                        HeightRequest="40"
                        CornerRadius="20"/>

                <Button Text="ðŸ”„"
                        Command="{Binding RefreshCommand}"
                        BackgroundColor="#FF9800"
                        TextColor="White"
                        WidthRequest="50"
                        HeightRequest="40"
                        CornerRadius="20"/>
            </HorizontalStackLayout>
        </Frame>
    </Grid>
</ContentPage>
