<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodel="clr-namespace:MyLoginApp.ViewModels.BaoCao"
             xmlns:converter="clr-namespace:MyLoginApp.Converters"
             x:Class="MyLoginApp.Pages.BaoCao.TonKhoLoaiVangPage"
             Title="Danh sách tồn kho loại vàng">

    <ContentPage.BindingContext>
        <viewmodel:TonKhoLoaiVangViewModel />
    </ContentPage.BindingContext>

    <ContentPage.Resources>
        <ResourceDictionary>
            <converter:IsGreaterThanOneConverter x:Key="IsGreaterThanOneConverter" />
            <converter:IsLessThanTongSoTrangConverter x:Key="IsLessThanTongSoTrangConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Padding="10" Spacing="10">

            <!-- Tìm kiếm -->
            <SearchBar Placeholder="Tìm kiếm..."
                       Text="{Binding TuKhoaTimKiem, Mode=TwoWay}"
                       SearchCommand="{Binding ThucHienTimKiemCommand}"
                       Margin="0,0,0,10" />

            <!-- Danh sách dạng card -->
            <CollectionView ItemsSource="{Binding DanhSachHienThiDaPhanTrang}"
                            SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame BackgroundColor="White"
                               CornerRadius="15"
                               Padding="15"
                               Margin="5"
                               HasShadow="True"
                               BorderColor="#cccccc">
                            <VerticalStackLayout Spacing="6">
                                <Label Text="{Binding HANGHOAMA, StringFormat='Mã hàng: {0}'}"
                                       FontAttributes="Bold"
                                       TextColor="DarkSlateBlue" />
                                <Label Text="{Binding HANG_HOA_TEN, StringFormat='Tên hàng: {0}'}" />
                                <Label Text="{Binding NHOM_TEN, StringFormat='Nhóm vàng: {0}'}" />
                                <Label Text="{Binding LOAI_TEN, StringFormat='Loại vàng: {0}'}" />
                                <Label Text="{Binding CAN_TONG, StringFormat='Cân tổng: {0:N2}'}" />
                                <Label Text="{Binding TL_HOT, StringFormat='TL Hột: {0:N2}'}" />
                                <Label Text="{Binding CONG_GOC, StringFormat='Công gốc: {0:N0}'}" />
                                <Label Text="{Binding GIA_CONG, StringFormat='Giá công: {0:N0}'}" />
                                <Label Text="{Binding ThanhTien, StringFormat='Thành tiền: {0:N0}'}"
                                       FontAttributes="Bold"
                                       TextColor="Green" />
                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Phân trang -->
            <Grid ColumnDefinitions="Auto,*,Auto" HorizontalOptions="Center" Margin="0,10">
                <Button Grid.Column="0"
                        Text="◀ Trước"
                        Command="{Binding GoToPreviousPageCommand}"
                        IsEnabled="{Binding CanGoPrevious}"
                        BackgroundColor="#2196F3"
                        TextColor="White"
                        WidthRequest="100"
                        HeightRequest="40"
                        CornerRadius="20" />

                <Label Grid.Column="1"
                       HorizontalOptions="Center"
                       VerticalOptions="Center"
                       Margin="20,0"
                       FontSize="16"
                       TextColor="#333">
                    <Label.FormattedText>
                        <FormattedString>
                            <Span Text="Trang "/>
                            <Span Text="{Binding CurrentPage}"/>
                            <Span Text="/"/>
                            <Span Text="{Binding TotalPages}"/>
                        </FormattedString>
                    </Label.FormattedText>
                </Label>

                <Button Grid.Column="2"
                        Text="Sau ▶"
                        Command="{Binding GoToNextPageCommand}"
                        IsEnabled="{Binding CanGoNext}"
                        BackgroundColor="#2196F3"
                        TextColor="White"
                        WidthRequest="100"
                        HeightRequest="40"
                        CornerRadius="20" />
            </Grid>

            <!-- Loading -->
            <Label IsVisible="{Binding IsBusy}"
                   Text="{Binding LoadingMessage}"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"
                   FontAttributes="Italic"
                   TextColor="Gray"/>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
