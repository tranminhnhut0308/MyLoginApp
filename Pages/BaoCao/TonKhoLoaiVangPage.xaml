<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodel="clr-namespace:MyLoginApp.ViewModels.BaoCao"
             xmlns:converter="clr-namespace:MyLoginApp.Converters"
             x:Class="MyLoginApp.Pages.BaoCao.TonKhoLoaiVangPage">

    <Shell.TitleView>
        <Grid>
            <Label Text="Tá»“n Kho Loáº¡i VÃ ng"
                   FontSize="22"
                   FontAttributes="Bold"
                   TextColor="White"
                   VerticalOptions="Center"
                   HorizontalOptions="Center" />
            <Button Text="ðŸ”"
                    FontSize="22"
                    Clicked="OnTimKiemClicked"
                    HorizontalOptions="End"
                    BackgroundColor="Transparent"
                    BorderColor="Transparent"/>
        </Grid>
    </Shell.TitleView>

    <ContentPage.BindingContext>
        <viewmodel:TonKhoLoaiVangViewModel />
    </ContentPage.BindingContext>

    <ContentPage.Resources>
        <ResourceDictionary>
            <converter:IsGreaterThanOneConverter x:Key="IsGreaterThanOneConverter" />
            <converter:IsLessThanTongSoTrangConverter x:Key="IsLessThanTongSoTrangConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Padding="10" Spacing="10">

            <!-- Summary Section -->
            <Frame BackgroundColor="White" CornerRadius="16" Padding="18" Margin="0,5,0,10" HasShadow="True">
                <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto" RowSpacing="12" ColumnSpacing="24">

                    <!-- Tá»•ng sá»‘ nhÃ³m vÃ ng -->
                    <VerticalStackLayout Grid.Column="0" Grid.Row="0" Spacing="2">
                        <Label Text="Tá»•ng sá»‘ nhÃ³m vÃ ng" TextColor="#888" FontSize="12"/>
                        <Label Text="{Binding TongSoLoaiVang}" TextColor="#1976D2" FontSize="16" FontAttributes="Bold"/>
                    </VerticalStackLayout>
                    
                    <!-- Tá»•ng thÃ nh tiá»n -->
                    <VerticalStackLayout Grid.Column="1" Grid.Row="0" Spacing="2">
                        <Label Text="Tá»•ng thÃ nh tiá»n" TextColor="#888" FontSize="12"/>
                        <Label Text="{Binding TongThanhTien, StringFormat='{0:N0} VNÄ'}" TextColor="#E53935" FontSize="16" FontAttributes="Bold"/>
                    </VerticalStackLayout>

                    <!-- Tá»•ng TL Há»™t -->
                    <VerticalStackLayout Grid.Column="0" Grid.Row="1" Spacing="2">
                        <Label Text="Tá»•ng TL Há»™t" TextColor="#888" FontSize="12"/>
                        <Label Text="{Binding TongTLHotFormatted}" TextColor="#222" FontSize="16" FontAttributes="Bold"/>
                    </VerticalStackLayout>

                    <!-- Tá»•ng cÃ¢n tá»•ng -->
                    <VerticalStackLayout Grid.Column="1" Grid.Row="1" Spacing="2">
                        <Label Text="Tá»•ng cÃ¢n tá»•ng" TextColor="#888" FontSize="12"/>
                        <Label Text="{Binding TongCanTongFormatted}" TextColor="#222" FontSize="16" FontAttributes="Bold"/>
                    </VerticalStackLayout>

                    <!-- Tá»•ng cÃ´ng gá»‘c -->
                    <VerticalStackLayout Grid.Column="0" Grid.Row="2" Spacing="2">
                        <Label Text="Tá»•ng cÃ´ng gá»‘c" TextColor="#888" FontSize="12"/>
                        <Label Text="{Binding TongCongGoc, StringFormat='{0:N0} VNÄ'}" TextColor="#FF9800" FontSize="16" FontAttributes="Bold"/>
                    </VerticalStackLayout>

                    <!-- Tá»•ng giÃ¡ cÃ´ng -->
                    <VerticalStackLayout Grid.Column="1" Grid.Row="2" Spacing="2">
                        <Label Text="Tá»•ng giÃ¡ cÃ´ng" TextColor="#888" FontSize="12"/>
                        <Label Text="{Binding TongGiaCong, StringFormat='{0:N0} VNÄ'}" TextColor="#FF9800" FontSize="16" FontAttributes="Bold"/>
                    </VerticalStackLayout>
                </Grid>
            </Frame>

            <!-- TÃ¬m kiáº¿m -->
            <!--<SearchBar Placeholder="TÃ¬m kiáº¿m..."
                       Text="{Binding TuKhoaTimKiem, Mode=TwoWay}"
                       SearchCommand="{Binding ThucHienTimKiemCommand}"
                       Margin="0,0,0,10" />-->

            <!-- Danh sÃ¡ch dáº¡ng card -->
            <CollectionView ItemsSource="{Binding DanhSachHienThiDaPhanTrang}"
                            SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame BackgroundColor="White"
                               CornerRadius="15"
                               Padding="15"
                               Margin="5"
                               HasShadow="True"
                               BorderColor="#cccccc">
                            <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto" RowSpacing="8" ColumnSpacing="12">
                                
                                <!-- HÃ ng 1: MÃ£ hÃ ng vÃ  TÃªn hÃ ng -->
                                <Label Grid.Row="0" Grid.Column="0" FontAttributes="Bold" TextColor="DarkSlateBlue">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="MÃ£: "/>
                                            <Span Text="{Binding HANGHOAMA}"/>
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>
                                <Label Grid.Row="0" Grid.Column="1" Text="{Binding HANG_HOA_TEN}" HorizontalOptions="Start" />

                                <!-- HÃ ng 2: NhÃ³m vÃ  Loáº¡i -->
                                <Label Grid.Row="1" Grid.Column="0" Text="{Binding NHOM_TEN, StringFormat='NhÃ³m: {0}'}" />
                                <Label Grid.Row="1" Grid.Column="1" Text="{Binding LOAI_TEN, StringFormat='Loáº¡i: {0}'}" HorizontalOptions="Start" />

                                <!-- HÃ ng 3: CÃ¢n tá»•ng vÃ  TL Há»™t -->
                                <Label Grid.Row="2" Grid.Column="0" Text="{Binding CanTongFormatted, StringFormat='CÃ¢n tá»•ng: {0}'}" />
                                <Label Grid.Row="2" Grid.Column="1" Text="{Binding TlHotFormatted, StringFormat='TL Há»™t: {0}'}" HorizontalOptions="Start" />

                                <!-- HÃ ng 4: CÃ´ng gá»‘c vÃ  GiÃ¡ cÃ´ng -->
                                <Label Grid.Row="3" Grid.Column="0" Text="{Binding CONG_GOC, StringFormat='CÃ´ng gá»‘c: {0:N0} VNÄ'}" />
                                <Label Grid.Row="3" Grid.Column="1" Text="{Binding GIA_CONG, StringFormat='GiÃ¡ cÃ´ng: {0:N0} VNÄ'}" HorizontalOptions="Start" />

                                <!-- HÃ ng 5: ThÃ nh tiá»n -->
                                <Label Grid.Row="4" Grid.ColumnSpan="2" HorizontalOptions="Start" FontAttributes="Bold" TextColor="Green">
                                     <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="ThÃ nh tiá»n: "/>
                                            <Span Text="{Binding ThanhTien, StringFormat='{0:N0} VNÄ'} "/>
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>

                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- PhÃ¢n trang -->
            <Grid ColumnDefinitions="Auto,*,Auto" HorizontalOptions="Center" Margin="0,10">
                <Button Grid.Column="0"
                        Text="â—€ TrÆ°á»›c"
                        Command="{Binding GoToPreviousPageCommand}"
                        IsEnabled="{Binding CanGoPrevious}"
                        BackgroundColor="#2196F3"
                        TextColor="White"
                        WidthRequest="100"
                        HeightRequest="40"
                        CornerRadius="20" />

                <Label Grid.Column="1"
                       HorizontalOptions="Center"
                       VerticalOptions="Center"
                       Margin="20,0"
                       FontSize="16"
                       TextColor="#333">
                    <Label.FormattedText>
                        <FormattedString>
                            <Span Text="Trang "/>
                            <Span Text="{Binding CurrentPage}"/>
                            <Span Text="/"/>
                            <Span Text="{Binding TotalPages}"/>
                        </FormattedString>
                    </Label.FormattedText>
                </Label>

                <Button Grid.Column="2"
                        Text="Sau â–¶"
                        Command="{Binding GoToNextPageCommand}"
                        IsEnabled="{Binding CanGoNext}"
                        BackgroundColor="#2196F3"
                        TextColor="White"
                        WidthRequest="100"
                        HeightRequest="40"
                        CornerRadius="20" />
            </Grid>

            <!-- Loading -->
            <Label IsVisible="{Binding IsBusy}"
                   Text="{Binding LoadingMessage}"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"
                   FontAttributes="Italic"
                   TextColor="Gray"/>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
